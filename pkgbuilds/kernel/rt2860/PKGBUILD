# Contributor: Jens Pranaitis <jens@jenux.homelinux.org>
#Contributor Antti Oja <antti.bofh(AT)gmail.com>
pkgname=rt2860
pkgver=1.8.0.0
pkgrel=8
pkgdesc="Drivers for rt2860/2890 chipset wireless cards"
arch=('i686' 'x86_64')
url="http://www.ralinktech.com/"
license="GPL"
depends=()
install=rt2860.install
source=('http://www.ralinktech.com.tw/data/drivers/2008_0918_RT2860_Linux_STA_v1.8.0.0.tar.bz2')
md5sums=('cc6167b73fd26cd6ffbbf41444ec5bdc')

build() {
	source "${startdir}"/../kernel.env
	cd "${srcdir}"/2008_0918_RT2860_Linux_STA_v1.8.0.0
	sed "s|LINUX_SRC = /lib/modules/\$(shell uname -r)/build|LINUX_SRC = ${_kerndir}|g" -i Makefile
	sed "s#\(/tftpboot\)#$startdir\1#" -i Makefile
	sed "s#HAS_WPA_SUPPLICANT=n#HAS_WPA_SUPPLICANT=y#" -i os/linux/config.mk
	sed "s#HAS_NATIVE_WPA_SUPPLICANT_SUPPORT=n#HAS_NATIVE_WPA_SUPPLICANT_SUPPORT=y#" -i os/linux/config.mk
	sed "s#dev->nd_net#dev_net(dev)#" -i os/linux/rt_main_dev.c
	make || return 1
	cd "${srcdir}"/2008_0918_RT2860_Linux_STA_v1.8.0.0/os/linux/
	install -D -m 755 rt2860sta.ko "${pkgdir}"/lib/modules/$_kernver/kernel/drivers/net/wireless/rt2860.ko
	sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" $startdir/*.install
}
